<!DOCTYPE html>
<html>
<head>
    <title>EcoPack AI Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #F1F8E9, #FFFDE7);
            font-family: 'Segoe UI', sans-serif;
        }

        h2 {
            font-weight: 700;
            color: #2E7D32;
        }

        /* KPI CARDS */
        .kpi-card {
            border-radius: 15px;
            padding: 25px;
            background: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: 0.3s ease;
            border-left: 6px solid #66BB6A;
        }

        .kpi-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.12);
        }

        .kpi-card h6 {
            font-weight: 600;
            color: #558B2F;
        }

        .kpi-card h4 {
            font-weight: bold;
            color: #1B5E20;
        }

        /* CHART CARDS */
        .chart-card {
            border-radius: 18px;
            padding: 25px;
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: 0.3s ease;
        }

        .chart-card:hover {
            transform: translateY(-5px);
        }

        .chart-card h5 {
            font-weight: 600;
            color: #4E342E;
            margin-bottom: 20px;
        }

        /* BUTTONS */
        .btn-danger {
            background: linear-gradient(135deg, #D32F2F, #F44336);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            transition: 0.3s;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(211,47,47,0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #388E3C, #66BB6A);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            transition: 0.3s;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(56,142,60,0.4);
        }

        .btn-secondary {
            border-radius: 10px;
            padding: 10px 20px;
        }

    </style>
</head>

<body>

<div class="container mt-5">

    <h2 class="text-center mb-5">üìà Sustainability Intelligence Dashboard</h2>

    <!-- KPI SECTION -->
    <div class="row text-center mb-5">

        <div class="col-md-3">
            <div class="kpi-card">
                <h6>üåç Avg CO‚ÇÇ</h6>
                <h4 id="avgCO2">--</h4>
            </div>
        </div>

        <div class="col-md-3">
            <div class="kpi-card">
                <h6>üí∞ Avg Cost</h6>
                <h4 id="avgCost">--</h4>
            </div>
        </div>

        <div class="col-md-3">
            <div class="kpi-card">
                <h6>üìâ CO‚ÇÇ Reduction %</h6>
                <h4 id="co2Reduction">--</h4>
            </div>
        </div>

        <div class="col-md-3">
            <div class="kpi-card">
                <h6>üíµ Cost Savings %</h6>
                <h4 id="costSavings">--</h4>
            </div>
        </div>

    </div>

    <!-- CHART ROW 1 -->
    <div class="row">

        <div class="col-md-6 mb-4">
            <div class="chart-card">
                <h5 class="text-center">Top 5 Cost Comparison</h5>
                <canvas id="costChart"></canvas>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="chart-card">
                <h5 class="text-center">Top 5 CO‚ÇÇ Comparison</h5>
                <canvas id="co2Chart"></canvas>
            </div>
        </div>

    </div>

    <!-- CHART ROW 2 -->
    <div class="row">

        <div class="col-md-6 mb-4">
            <div class="chart-card">
                <h5 class="text-center">Suitability Comparison</h5>
                <canvas id="suitabilityChart"></canvas>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="chart-card">
                <h5 class="text-center">Material Usage Trend</h5>
                <canvas id="usageChart"></canvas>
            </div>
        </div>

    </div>

    <!-- BUTTONS -->
    <div class="text-center mt-4 mb-5">
        <button onclick="exportPDF()" class="btn btn-danger me-3">
            Export PDF Report
        </button>
        <button onclick="exportExcel()" class="btn btn-success me-3">
            Export Excel Report
        </button>
        <a href="/" class="btn btn-secondary">
            Back to Recommendation
        </a>
    </div>

</div>

<script>

async function loadMetrics() {
    const response = await fetch("/api/dashboard-metrics");
    const data = await response.json();

    document.getElementById("avgCO2").innerText =
        data.avg_co2 + " kg";

    document.getElementById("avgCost").innerText =
        "‚Çπ " + data.avg_cost;

    document.getElementById("co2Reduction").innerText =
        data.co2_reduction_percent + " %";

    document.getElementById("costSavings").innerText =
        data.cost_savings_percent + " %";
}

async function loadCharts() {

    const response = await fetch("/api/trends");
    const data = await response.json();

    const materials = data.comparison.map(item => item.material_name);
    const costs = data.comparison.map(item => item.cost_rupees);
    const co2 = data.comparison.map(item => item.co2_score);
    const suitability = data.comparison.map(item => item.suitability_score);

    const usageMaterials = data.usage_trend.map(item => item.material_name);
    const usageCounts = data.usage_trend.map(item => item.count);

    new Chart(document.getElementById("costChart"), {
        type: "bar",
        data: {
            labels: materials,
            datasets: [{
                label: "Cost (‚Çπ)",
                data: costs,
                backgroundColor: "#FFD54F"
            }]
        }
    });

    new Chart(document.getElementById("co2Chart"), {
        type: "bar",
        data: {
            labels: materials,
            datasets: [{
                label: "CO‚ÇÇ Score",
                data: co2,
                backgroundColor: "#81C784"
            }]
        }
    });

    new Chart(document.getElementById("suitabilityChart"), {
        type: "line",
        data: {
            labels: materials,
            datasets: [{
                label: "Suitability Score",
                data: suitability,
                borderColor: "#2E7D32",
                backgroundColor: "rgba(46,125,50,0.2)",
                fill: true
            }]
        }
    });

    new Chart(document.getElementById("usageChart"), {
        type: "bar",
        data: {
            labels: usageMaterials,
            datasets: [{
                label: "Usage Count",
                data: usageCounts,
                backgroundColor: "#64B5F6"
            }]
        }
    });
}

function exportPDF() {
    window.open("/api/export/pdf", "_blank");
}

function exportExcel() {
    window.open("/api/export/excel", "_blank");
}

loadMetrics();
loadCharts();

</script>

</body>
</html>